<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TidyversePractice • lagniappe</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="TidyversePractice">
<meta property="og:description" content="lagniappe">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">lagniappe</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">3.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/HapMap.html">Haplotype Maps</a>
    </li>
    <li>
      <a href="../articles/MappingAndTidyverse.html">TidyversePractice</a>
    </li>
    <li>
      <a href="../articles/OysterMap.html">Processing Oyster Sites</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="MappingAndTidyverse_files/htmlwidgets-1.6.2/htmlwidgets.js"></script><link href="MappingAndTidyverse_files/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="MappingAndTidyverse_files/leaflet-1.3.1/leaflet.js"></script><link href="MappingAndTidyverse_files/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="MappingAndTidyverse_files/proj4-2.6.2/proj4.min.js"></script><script src="MappingAndTidyverse_files/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="MappingAndTidyverse_files/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="MappingAndTidyverse_files/leaflet-binding-2.2.0/leaflet.js"></script><link href="MappingAndTidyverse_files/leaflet-markercluster-1.0.5/MarkerCluster.css" rel="stylesheet">
<link href="MappingAndTidyverse_files/leaflet-markercluster-1.0.5/MarkerCluster.Default.css" rel="stylesheet">
<script src="MappingAndTidyverse_files/leaflet-markercluster-1.0.5/leaflet.markercluster.js"></script><script src="MappingAndTidyverse_files/leaflet-markercluster-1.0.5/leaflet.markercluster.freezable.js"></script><script src="MappingAndTidyverse_files/leaflet-markercluster-1.0.5/leaflet.markercluster.layersupport.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>GBIF And Spatial Data</h1>
                        <h4 data-toc-skip class="author">April
Wright</h4>
            
            <h4 data-toc-skip class="date">2024-03-20</h4>
      
      
      <div class="hidden name"><code>MappingAndTidyverse.Rmd</code></div>

    </div>

    
    
<p>You’ve seen R. We’re going to start off today by introducing
Tidyverse, which is fast becoming a dominant force in data science
related fields. We’re going to play a bit with some map-making, then
move on to working with some real data from a Lagniappe lab.</p>
<p>We will work with two packages today. One is <a href="https://www.gbif.org/tool/81747/rgbif" class="external-link">RGBIF</a>, an interface to
<a href="https://www.gbif.org/" class="external-link">GBIF</a> data maintained by the <a href="https://ropensci.org/" class="external-link">ROpenSci</a> group.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"tidyverse"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"rgbif"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"leaflet"</span><span class="op">)</span></span></code></pre></div>
<p>Later in this lesson, we will also use the <code>rotl</code> package
we’ve seen last week.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ── <span style="font-weight: bold;">Attaching core tidyverse packages</span> ──────────────────────── tidyverse 2.0.0 ──</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">dplyr    </span> 1.1.3     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">readr    </span> 2.1.4</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">forcats  </span> 1.0.0     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">stringr  </span> 1.5.0</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">ggplot2  </span> 3.4.4     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tibble   </span> 3.2.1</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">lubridate</span> 1.9.3     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tidyr    </span> 1.3.0</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">purrr    </span> 1.0.2     </span></span>
<span><span class="co">## ── <span style="font-weight: bold;">Conflicts</span> ────────────────────────────────────────── tidyverse_conflicts() ──</span></span>
<span><span class="co">## <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">filter()</span> masks <span style="color: #0000BB;">stats</span>::filter()</span></span>
<span><span class="co">## <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">lag()</span>    masks <span style="color: #0000BB;">stats</span>::lag()</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use the conflicted package (<span style="color: #0000BB; font-style: italic;">&lt;http://conflicted.r-lib.org/&gt;</span>) to force all conflicts to become errors</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rotl/" class="external-link">rotl</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rgbif" class="external-link">rgbif</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/leaflet/" class="external-link">leaflet</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
<p>First, we’re going to try an example for one ant. We will query
locality data and map it in a few ways. Then, you will figure out how to
make the process of mapping data iterable over a set of taxa.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/name_suggest.html" class="external-link">name_suggest</a></span><span class="op">(</span><span class="st">"Atta mexicana"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Records returned [1] </span></span>
<span><span class="co">## No. unique hierarchies [0] </span></span>
<span><span class="co">## Args [q=Atta mexicana, limit=100, fields1=key, fields2=canonicalName,</span></span>
<span><span class="co">##      fields3=rank] </span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">##       key canonicalName rank   </span></span>
<span><span class="co">##     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> 5<span style="text-decoration: underline;">035</span>745 Atta mexicana SPECIES</span></span></code></pre>
<p>Next, we’re going to use <code>occ_search</code> to search the GBIF
database for where these things are occurring.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">occurences</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/occ_search.html" class="external-link">occ_search</a></span><span class="op">(</span>taxonKey <span class="op">=</span> <span class="fl">5035745</span>, limit <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></code></pre></div>
<p>Next, we will filter the resultant dataset to name and lat and
longitude data.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">no_na</span> <span class="op">&lt;-</span> <span class="va">occurences</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">scientificName</span>, <span class="va">decimalLatitude</span>, <span class="va">decimalLongitude</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html" class="external-link">drop_na</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>And finally, we will plot the data using <code>leaflet</code></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fu">leaflet</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/leaflet/reference/leaflet.html" class="external-link">leaflet</a></span><span class="op">(</span><span class="va">no_na</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/map-layers.html" class="external-link">addTiles</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/map-layers.html" class="external-link">addMarkers</a></span><span class="op">(</span><span class="op">~</span><span class="va">decimalLongitude</span>, <span class="op">~</span><span class="va">decimalLatitude</span>, popup <span class="op">=</span> <span class="va">no_na</span><span class="op">$</span><span class="va">scientificName</span><span class="op">)</span></span>
<span></span>
<span><span class="va">k</span></span></code></pre></div>
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-6f01f8e8ad4736ee9729" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-6f01f8e8ad4736ee9729">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org/copyright/\">OpenStreetMap<\/a>,  <a href=\"https://opendatacommons.org/licenses/odbl/\">ODbL<\/a>"}]},{"method":"addMarkers","args":[[20.757191,15.836759,19.674249,29.244622,18.13462,20.38177,25.677157,18.940196,19.522914,19.522922,19.522878,19.770436,19.443778,20.677911,17.060492,16.958572,19.774067,24.881118,20.37285,19.6921],[-103.415009,-97.04085600000001,-101.213749,-110.838142,-97.453575,-99.648056,-100.234227,-99.23607699999999,-96.912564,-96.912564,-96.912559,-101.149608,-101.872953,-103.439701,-96.516175,-96.45034699999999,-104.3598,-107.296635,-104.822937,-103.451678],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["Atta mexicana (Smith, 1858)","Atta mexicana (Smith, 1858)","Atta mexicana (Smith, 1858)","Atta mexicana (Smith, 1858)","Atta mexicana (Smith, 1858)","Atta mexicana (Smith, 1858)","Atta mexicana (Smith, 1858)","Atta mexicana (Smith, 1858)","Atta mexicana (Smith, 1858)","Atta mexicana (Smith, 1858)","Atta mexicana (Smith, 1858)","Atta mexicana (Smith, 1858)","Atta mexicana (Smith, 1858)","Atta mexicana (Smith, 1858)","Atta mexicana (Smith, 1858)","Atta mexicana (Smith, 1858)","Atta mexicana (Smith, 1858)","Atta mexicana (Smith, 1858)","Atta mexicana (Smith, 1858)","Atta mexicana (Smith, 1858)"],null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[15.836759,29.244622],"lng":[-110.838142,-96.45034699999999]}},"evals":[],"jsHooks":[]}</script><p>This looks much like plotting with <code>ggplot</code> and tidyverse.
That’s because leaflet is based on the same principles. We establish a
canvas and the data in the first line, then we add tiles (the actual map
we will use), and then we add our points. When we think about it, this
is quite similar to establishing a ggplot canvas, the axes, and the
points to plot.</p>
<p>One point is easy. How often do we only want one point, though?
Probably, we will want to plot several species. First, with a partner,
work out how to get GBIF ids for a set of taxa.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ants</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Martialis"</span>, <span class="st">"Atta"</span>, <span class="st">"Ectatomma"</span>, <span class="st">"Tatuidris"</span>, <span class="st">"Aneuretus"</span>, <span class="st">"Xymmer"</span><span class="op">)</span></span></code></pre></div>
<p>Now, we will get the actual specimen occurrences for these ants.
Practice using an apply function to do this. Inspect the object you’ve
queried when you’ve completed your loop. Have we dealt with an object
like this before?</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">search_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">ant</span> <span class="kw">in</span> <span class="va">ants</span><span class="op">)</span><span class="op">{</span></span>
<span>   <span class="va">query</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/name_suggest.html" class="external-link">name_suggest</a></span><span class="op">(</span><span class="va">ant</span>, rank <span class="op">=</span> <span class="st">"genus"</span><span class="op">)</span></span>
<span>   <span class="va">search</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/occ_search.html" class="external-link">occ_search</a></span><span class="op">(</span>taxonKey <span class="op">=</span> <span class="va">query</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">key</span>, limit <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span>   <span class="va">search_results</span><span class="op">[[</span><span class="va">ant</span><span class="op">]</span><span class="op">]</span><span class="op">&lt;-</span> <span class="va">search</span><span class="op">$</span><span class="va">data</span></span>
<span> <span class="op">}</span></span></code></pre></div>
<p>This is a vector or dataframes. Each individual query made it’s own
dataframe. For simplicity, lets combine them into one dataframe
object.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Combine the resultant dataframes into one large dataframe</span></span>
<span><span class="va">mega_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">search_results</span>, .id <span class="op">=</span> <span class="st">"column_label"</span><span class="op">)</span></span></code></pre></div>
<p>Since we will be plotting these with a map, we need complete data in
both columns - lat and long. Let’s drop any columns without data in
both.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Drop rows with NA values in the lat and long</span></span>
<span><span class="va">no_na</span> <span class="op">&lt;-</span> <span class="va">mega_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">scientificName</span>, <span class="va">decimalLatitude</span>, <span class="va">decimalLongitude</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html" class="external-link">drop_na</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Now let’s take a peek at our results!</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot the dataframe of observations</span></span>
<span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fu">leaflet</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/leaflet/reference/leaflet.html" class="external-link">leaflet</a></span><span class="op">(</span><span class="va">no_na</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://rstudio.github.io/leaflet/reference/map-layers.html" class="external-link">addTiles</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="fu"><a href="https://rstudio.github.io/leaflet/reference/map-layers.html" class="external-link">addMarkers</a></span><span class="op">(</span><span class="op">~</span><span class="va">decimalLongitude</span>, <span class="op">~</span><span class="va">decimalLatitude</span>, popup <span class="op">=</span> <span class="va">no_na</span><span class="op">$</span><span class="va">scientificName</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="geospatial-choose-your-own-adventure">GeoSpatial Choose Your Own Adventure<a class="anchor" aria-label="anchor" href="#geospatial-choose-your-own-adventure"></a>
</h2>
<p>Below are six code snippets to do different types of map-based
plotting. With a partner, discuss what you think would be interesting or
important to view in these data. Choose a block of code to modify to
accomplish your visualization. We will reconvene in about 30 minutes and
do a Round Robin showing everyone’s maps. <em>Have Fun!</em></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rstudio.github.io/leaflet/reference/leaflet.html" class="external-link">leaflet</a></span><span class="op">(</span><span class="va">no_na</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/map-layers.html" class="external-link">addTiles</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/map-layers.html" class="external-link">addCircles</a></span><span class="op">(</span><span class="op">~</span><span class="va">decimalLongitude</span>, <span class="op">~</span><span class="va">decimalLatitude</span><span class="op">)</span></span></code></pre></div>
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-cc896e76b2d89d59cc49" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-cc896e76b2d89d59cc49">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org/copyright/\">OpenStreetMap<\/a>,  <a href=\"https://opendatacommons.org/licenses/odbl/\">ODbL<\/a>"}]},{"method":"addCircles","args":[[-2.883,-2.88333,-2.88333,-2.38692,-2.38692,-2.37204,-2.38897,-2.38897,-0.474995,15.768465,-21.816105,10.440996,15.731852,-19.136219,20.869258,10.493213,20.869369,10.483252,-0.050611,10.34435,10.34435,17.05,10.763,10.763,19.97807,19.97807,19.97807,4.028889,6.42167,6.42167,6.42167,6.42167,6.42167,6.42167,6.42167,6.682778,6.682778,6.73333,5.83093,5.84598,5.84598,5.84598,5.83117,5.83458,-14.43462,-14.43462,-14.43462,-12.817],[-59.983,-59.98333,-59.98333,-59.87494,-59.87494,-59.87252,-59.85012,-59.85012,-76.322463,-96.13542200000001,-41.293408,-84.668093,-96.161812,-40.057902,-89.62144000000001,-66.839465,-89.622191,-84.71355200000001,-78.767917,-84.67139,-84.67139,-88.56999999999999,-85.334,-85.334,-97.42486,-97.42486,-97.42486,-76.157917,80.42,80.42,80.42,80.42,80.42,80.42,80.42,80.39917,80.39917,80.4333,-7.344,-7.34815,-7.34815,-7.34815,-7.3429,-7.34638,49.75853,49.75853,49.75853,49.79228],10,null,null,{"interactive":true,"className":"","stroke":true,"color":"#03F","weight":5,"opacity":0.5,"fill":true,"fillColor":"#03F","fillOpacity":0.2},null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null,null]}],"limits":{"lat":[-21.816105,20.869369],"lng":[-97.42486,80.4333]}},"evals":[],"jsHooks":[]}</script><div class="section level4">
<h4 id="draw-point-sizes-from-a-distribution">Draw point sizes from a distribution<a class="anchor" aria-label="anchor" href="#draw-point-sizes-from-a-distribution"></a>
</h4>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rstudio.github.io/leaflet/reference/leaflet.html" class="external-link">leaflet</a></span><span class="op">(</span><span class="va">no_na</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/map-layers.html" class="external-link">addTiles</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/map-layers.html" class="external-link">addCircleMarkers</a></span><span class="op">(</span><span class="op">~</span><span class="va">decimalLongitude</span>, <span class="op">~</span><span class="va">decimalLatitude</span>, radius <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">4</span>, <span class="fl">10</span><span class="op">)</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'red'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-8521a6a8c1d01a89d266" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-8521a6a8c1d01a89d266">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org/copyright/\">OpenStreetMap<\/a>,  <a href=\"https://opendatacommons.org/licenses/odbl/\">ODbL<\/a>"}]},{"method":"addCircleMarkers","args":[[-2.883,-2.88333,-2.88333,-2.38692,-2.38692,-2.37204,-2.38897,-2.38897,-0.474995,15.768465,-21.816105,10.440996,15.731852,-19.136219,20.869258,10.493213,20.869369,10.483252,-0.050611,10.34435,10.34435,17.05,10.763,10.763,19.97807,19.97807,19.97807,4.028889,6.42167,6.42167,6.42167,6.42167,6.42167,6.42167,6.42167,6.682778,6.682778,6.73333,5.83093,5.84598,5.84598,5.84598,5.83117,5.83458,-14.43462,-14.43462,-14.43462,-12.817],[-59.983,-59.98333,-59.98333,-59.87494,-59.87494,-59.87252,-59.85012,-59.85012,-76.322463,-96.13542200000001,-41.293408,-84.668093,-96.161812,-40.057902,-89.62144000000001,-66.839465,-89.622191,-84.71355200000001,-78.767917,-84.67139,-84.67139,-88.56999999999999,-85.334,-85.334,-97.42486,-97.42486,-97.42486,-76.157917,80.42,80.42,80.42,80.42,80.42,80.42,80.42,80.39917,80.39917,80.4333,-7.344,-7.34815,-7.34815,-7.34815,-7.3429,-7.34638,49.75853,49.75853,49.75853,49.79228],[9.869540560990572,8.007910726126283,4.843056289944798,4.161917037330568,6.101834585424513,6.022138838190585,6.348761503584683,6.482738814782351,9.967003130819649,8.339747255202383,4.74527554307133,5.817287968937308,5.908575592096895,7.807690707501024,8.469437039922923,9.762037034146488,8.842584707774222,7.40661342209205,8.354625190608203,4.897358555812389,9.496618293691427,5.292126404121518,5.608979153912514,6.312306149397045,8.166130007244647,7.698798615019768,8.971135664265603,4.387624557130039,7.534852131735533,4.196896364912391,9.517304534558207,9.888982449658215,6.749067512806505,8.030602411366999,7.899636609014124,4.921301578171551,6.648925129789859,7.741693577263504,7.519458276219666,4.447401247918606,9.04355356702581,4.909418605733663,8.730721964035183,5.360647945664823,7.42923721531406,7.496394085232168,8.192610906437039,7.104147140402347,5.623124811332673,4.343066647648811,9.812354110181332,4.572149337735027,5.690163450315595,7.694449767936021,9.779184776358306,4.954799556639045,7.36991192214191,5.040386212989688,9.052367275115103,5.191928521730006,7.670489903539419,4.177209154702723,6.180852523073554,6.848538967780769,5.83174366177991,8.786694888491184,7.921179034747183,8.738415623549372,6.548764180857688,6.533910765312612,7.854991611558944,9.247755097225308,6.725880793761462,4.712628977373242,4.511276442091912,4.422384224366397,5.461283232085407,5.116598090622574,6.73012928571552,7.396146378014237,9.106622208375484,9.312500342726707,4.707256698515266,6.850280931219459,4.50253580044955,7.103160685393959,5.202956878114492,4.230767296161503,9.216023523826152,8.253122311551124,6.028286783955991,7.87384666223079,5.268059773836285,4.622293296735734,6.789189326576889,6.71222044993192,8.243926406838,8.253908244892955,6.072379040997475,7.558420815505087],null,null,{"interactive":true,"className":"","stroke":true,"color":"red","weight":5,"opacity":0.5,"fill":true,"fillColor":"red","fillOpacity":0.2},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[-21.816105,20.869369],"lng":[-97.42486,80.4333]}},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level4">
<h4 id="cluster-observations">Cluster observations<a class="anchor" aria-label="anchor" href="#cluster-observations"></a>
</h4>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rstudio.github.io/leaflet/reference/leaflet.html" class="external-link">leaflet</a></span><span class="op">(</span><span class="va">no_na</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/map-layers.html" class="external-link">addTiles</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/map-layers.html" class="external-link">addMarkers</a></span><span class="op">(</span><span class="op">~</span><span class="va">decimalLongitude</span>, <span class="op">~</span><span class="va">decimalLatitude</span>, clusterOptions <span class="op">=</span> <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/map-options.html" class="external-link">markerClusterOptions</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-67434bf8624f05a52916" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-67434bf8624f05a52916">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org/copyright/\">OpenStreetMap<\/a>,  <a href=\"https://opendatacommons.org/licenses/odbl/\">ODbL<\/a>"}]},{"method":"addMarkers","args":[[-2.883,-2.88333,-2.88333,-2.38692,-2.38692,-2.37204,-2.38897,-2.38897,-0.474995,15.768465,-21.816105,10.440996,15.731852,-19.136219,20.869258,10.493213,20.869369,10.483252,-0.050611,10.34435,10.34435,17.05,10.763,10.763,19.97807,19.97807,19.97807,4.028889,6.42167,6.42167,6.42167,6.42167,6.42167,6.42167,6.42167,6.682778,6.682778,6.73333,5.83093,5.84598,5.84598,5.84598,5.83117,5.83458,-14.43462,-14.43462,-14.43462,-12.817],[-59.983,-59.98333,-59.98333,-59.87494,-59.87494,-59.87252,-59.85012,-59.85012,-76.322463,-96.13542200000001,-41.293408,-84.668093,-96.161812,-40.057902,-89.62144000000001,-66.839465,-89.622191,-84.71355200000001,-78.767917,-84.67139,-84.67139,-88.56999999999999,-85.334,-85.334,-97.42486,-97.42486,-97.42486,-76.157917,80.42,80.42,80.42,80.42,80.42,80.42,80.42,80.39917,80.39917,80.4333,-7.344,-7.34815,-7.34815,-7.34815,-7.3429,-7.34638,49.75853,49.75853,49.75853,49.79228],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},null,null,{"showCoverageOnHover":true,"zoomToBoundsOnClick":true,"spiderfyOnMaxZoom":true,"removeOutsideVisibleBounds":true,"spiderLegPolylineOptions":{"weight":1.5,"color":"#222","opacity":0.5},"freezeAtZoom":false},null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[-21.816105,20.869369],"lng":[-97.42486,80.4333]}},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level4">
<h4 id="size-points-by-number-of-observations">Size points by number of observations<a class="anchor" aria-label="anchor" href="#size-points-by-number-of-observations"></a>
</h4>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">no_na</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">decimalLatitude</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>n_areas <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/leaflet.html" class="external-link">leaflet</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/map-layers.html" class="external-link">addTiles</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/map-layers.html" class="external-link">addCircleMarkers</a></span><span class="op">(</span><span class="op">~</span><span class="va">decimalLongitude</span>, <span class="op">~</span><span class="va">decimalLatitude</span>, radius <span class="op">=</span> <span class="op">~</span><span class="va">n_areas</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'red'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-31cdd80d502de27140a3" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-31cdd80d502de27140a3">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org/copyright/\">OpenStreetMap<\/a>,  <a href=\"https://opendatacommons.org/licenses/odbl/\">ODbL<\/a>"}]},{"method":"addCircleMarkers","args":[[-2.883,-2.88333,-2.88333,-2.38692,-2.38692,-2.37204,-2.38897,-2.38897,-0.474995,15.768465,-21.816105,10.440996,15.731852,-19.136219,20.869258,10.493213,20.869369,10.483252,-0.050611,10.34435,10.34435,17.05,10.763,10.763,19.97807,19.97807,19.97807,4.028889,6.42167,6.42167,6.42167,6.42167,6.42167,6.42167,6.42167,6.682778,6.682778,6.73333,5.83093,5.84598,5.84598,5.84598,5.83117,5.83458,-14.43462,-14.43462,-14.43462,-12.817],[-59.983,-59.98333,-59.98333,-59.87494,-59.87494,-59.87252,-59.85012,-59.85012,-76.322463,-96.13542200000001,-41.293408,-84.668093,-96.161812,-40.057902,-89.62144000000001,-66.839465,-89.622191,-84.71355200000001,-78.767917,-84.67139,-84.67139,-88.56999999999999,-85.334,-85.334,-97.42486,-97.42486,-97.42486,-76.157917,80.42,80.42,80.42,80.42,80.42,80.42,80.42,80.39917,80.39917,80.4333,-7.344,-7.34815,-7.34815,-7.34815,-7.3429,-7.34638,49.75853,49.75853,49.75853,49.79228],[1,2,2,2,2,1,2,2,1,1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,3,3,3,1,7,7,7,7,7,7,7,2,2,1,1,3,3,3,1,1,3,3,3,1],null,null,{"interactive":true,"className":"","stroke":true,"color":"red","weight":5,"opacity":0.5,"fill":true,"fillColor":"red","fillOpacity":0.2},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[-21.816105,20.869369],"lng":[-97.42486,80.4333]}},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level4">
<h4 id="color-points-by-species">Color points by species<a class="anchor" aria-label="anchor" href="#color-points-by-species"></a>
</h4>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/colorNumeric.html" class="external-link">colorBin</a></span><span class="op">(</span></span>
<span>  palette <span class="op">=</span> <span class="st">"Blues"</span>,</span>
<span>  <span class="va">no_na</span><span class="op">$</span><span class="va">scientificName</span>,</span>
<span>  pretty <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in pretty.default(domain %||% x, n = bins): NAs introduced by coercion</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">levs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">no_na</span><span class="op">$</span><span class="va">scientificName</span><span class="op">)</span></span>
<span><span class="va">factpal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/colorNumeric.html" class="external-link">colorFactor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">topo.colors</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>, <span class="va">levs</span><span class="op">)</span></span>
<span></span>
<span><span class="va">no_na</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">scientificName</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/leaflet.html" class="external-link">leaflet</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/map-layers.html" class="external-link">addTiles</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/map-layers.html" class="external-link">addCircleMarkers</a></span><span class="op">(</span></span>
<span>    <span class="op">~</span><span class="va">decimalLongitude</span>, </span>
<span>    <span class="op">~</span><span class="va">decimalLatitude</span>,</span>
<span>    color <span class="op">=</span> <span class="op">~</span><span class="fu">factpal</span><span class="op">(</span><span class="va">scientificName</span><span class="op">)</span>,</span>
<span>    stroke <span class="op">=</span> <span class="cn">FALSE</span>, fillOpacity <span class="op">=</span> <span class="fl">0.5</span></span>
<span>  <span class="op">)</span> </span></code></pre></div>
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-fe691da194bcc86391db" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-fe691da194bcc86391db">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org/copyright/\">OpenStreetMap<\/a>,  <a href=\"https://opendatacommons.org/licenses/odbl/\">ODbL<\/a>"}]},{"method":"addCircleMarkers","args":[[-2.883,-2.88333,-2.88333,-2.38692,-2.38692,-2.37204,-2.38897,-2.38897,-0.474995,15.768465,-21.816105,10.440996,15.731852,-19.136219,20.869258,10.493213,20.869369,10.483252,-0.050611,10.34435,10.34435,17.05,10.763,10.763,19.97807,19.97807,19.97807,4.028889,6.42167,6.42167,6.42167,6.42167,6.42167,6.42167,6.42167,6.682778,6.682778,6.73333,5.83093,5.84598,5.84598,5.84598,5.83117,5.83458,-14.43462,-14.43462,-14.43462,-12.817],[-59.983,-59.98333,-59.98333,-59.87494,-59.87494,-59.87252,-59.85012,-59.85012,-76.322463,-96.13542200000001,-41.293408,-84.668093,-96.161812,-40.057902,-89.62144000000001,-66.839465,-89.622191,-84.71355200000001,-78.767917,-84.67139,-84.67139,-88.56999999999999,-85.334,-85.334,-97.42486,-97.42486,-97.42486,-76.157917,80.42,80.42,80.42,80.42,80.42,80.42,80.42,80.39917,80.39917,80.4333,-7.344,-7.34815,-7.34815,-7.34815,-7.3429,-7.34638,49.75853,49.75853,49.75853,49.79228],10,null,null,{"interactive":true,"className":"","stroke":false,"color":["#2BFB6C","#2BFB6C","#2BFB6C","#2BFB6C","#2BFB6C","#2BFB6C","#2BFB6C","#2BFB6C","#3CECD0","#39BAFF","#3CECD0","#3CECD0","#3CECD0","#3CECD0","#39BAFF","#39BAFF","#3CECD0","#2863FF","#A2FF39","#A2FF39","#A2FF39","#A2FF39","#3338FF","#3338FF","#A2FF39","#A2FF39","#A2FF39","#A2FF39","#4C00FF","#4C00FF","#4C00FF","#4C00FF","#4C00FF","#4C00FF","#4C00FF","#4C00FF","#4C00FF","#4C00FF","#FFFF00","#FFFF00","#FFFF00","#FFFF00","#FFFF00","#FFFF00","#FFFF00","#FFFF00","#FFFF00","#FFFF00"],"weight":5,"opacity":0.5,"fill":true,"fillColor":["#2BFB6C","#2BFB6C","#2BFB6C","#2BFB6C","#2BFB6C","#2BFB6C","#2BFB6C","#2BFB6C","#3CECD0","#39BAFF","#3CECD0","#3CECD0","#3CECD0","#3CECD0","#39BAFF","#39BAFF","#3CECD0","#2863FF","#A2FF39","#A2FF39","#A2FF39","#A2FF39","#3338FF","#3338FF","#A2FF39","#A2FF39","#A2FF39","#A2FF39","#4C00FF","#4C00FF","#4C00FF","#4C00FF","#4C00FF","#4C00FF","#4C00FF","#4C00FF","#4C00FF","#4C00FF","#FFFF00","#FFFF00","#FFFF00","#FFFF00","#FFFF00","#FFFF00","#FFFF00","#FFFF00","#FFFF00","#FFFF00"],"fillOpacity":0.5},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[-21.816105,20.869369],"lng":[-97.42486,80.4333]}},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level4">
<h4 id="set-view-width">Set view Width<a class="anchor" aria-label="anchor" href="#set-view-width"></a>
</h4>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/colorNumeric.html" class="external-link">colorBin</a></span><span class="op">(</span></span>
<span>  palette <span class="op">=</span> <span class="st">"Blues"</span>,</span>
<span>  <span class="va">no_na</span><span class="op">$</span><span class="va">scientificName</span>,</span>
<span>  pretty <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in pretty.default(domain %||% x, n = bins): NAs introduced by coercion</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">levs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">no_na</span><span class="op">$</span><span class="va">scientificName</span><span class="op">)</span></span>
<span><span class="va">factpal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/colorNumeric.html" class="external-link">colorFactor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">topo.colors</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>, <span class="va">levs</span><span class="op">)</span></span>
<span></span>
<span><span class="va">no_na</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">scientificName</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/leaflet.html" class="external-link">leaflet</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/map-layers.html" class="external-link">addTiles</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/map-layers.html" class="external-link">addCircleMarkers</a></span><span class="op">(</span></span>
<span>    <span class="op">~</span><span class="va">decimalLongitude</span>, </span>
<span>    <span class="op">~</span><span class="va">decimalLatitude</span>,</span>
<span>    color <span class="op">=</span> <span class="op">~</span><span class="fu">factpal</span><span class="op">(</span><span class="va">scientificName</span><span class="op">)</span>,</span>
<span>    stroke <span class="op">=</span> <span class="cn">FALSE</span>, fillOpacity <span class="op">=</span> <span class="fl">0.5</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/map-methods.html" class="external-link">setView</a></span><span class="op">(</span> lng <span class="op">=</span> <span class="op">-</span><span class="fl">100</span>,</span>
<span>            lat <span class="op">=</span> <span class="fl">20</span>,</span>
<span>            zoom <span class="op">=</span> <span class="fl">11</span> <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rstudio.github.io/leaflet/reference/map-methods.html" class="external-link">setMaxBounds</a></span><span class="op">(</span> lng1 <span class="op">=</span> <span class="op">-</span><span class="fl">100</span>,</span>
<span>                lat1 <span class="op">=</span> <span class="fl">19.432241</span>,</span>
<span>                lng2 <span class="op">=</span> <span class="op">-</span><span class="fl">98</span>,</span>
<span>                lat2 <span class="op">=</span> <span class="fl">20</span> <span class="op">)</span></span></code></pre></div>
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-9b8f0c89273b4d2cbf1d" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-9b8f0c89273b4d2cbf1d">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org/copyright/\">OpenStreetMap<\/a>,  <a href=\"https://opendatacommons.org/licenses/odbl/\">ODbL<\/a>"}]},{"method":"addCircleMarkers","args":[[-2.883,-2.88333,-2.88333,-2.38692,-2.38692,-2.37204,-2.38897,-2.38897,-0.474995,15.768465,-21.816105,10.440996,15.731852,-19.136219,20.869258,10.493213,20.869369,10.483252,-0.050611,10.34435,10.34435,17.05,10.763,10.763,19.97807,19.97807,19.97807,4.028889,6.42167,6.42167,6.42167,6.42167,6.42167,6.42167,6.42167,6.682778,6.682778,6.73333,5.83093,5.84598,5.84598,5.84598,5.83117,5.83458,-14.43462,-14.43462,-14.43462,-12.817],[-59.983,-59.98333,-59.98333,-59.87494,-59.87494,-59.87252,-59.85012,-59.85012,-76.322463,-96.13542200000001,-41.293408,-84.668093,-96.161812,-40.057902,-89.62144000000001,-66.839465,-89.622191,-84.71355200000001,-78.767917,-84.67139,-84.67139,-88.56999999999999,-85.334,-85.334,-97.42486,-97.42486,-97.42486,-76.157917,80.42,80.42,80.42,80.42,80.42,80.42,80.42,80.39917,80.39917,80.4333,-7.344,-7.34815,-7.34815,-7.34815,-7.3429,-7.34638,49.75853,49.75853,49.75853,49.79228],10,null,null,{"interactive":true,"className":"","stroke":false,"color":["#2BFB6C","#2BFB6C","#2BFB6C","#2BFB6C","#2BFB6C","#2BFB6C","#2BFB6C","#2BFB6C","#3CECD0","#39BAFF","#3CECD0","#3CECD0","#3CECD0","#3CECD0","#39BAFF","#39BAFF","#3CECD0","#2863FF","#A2FF39","#A2FF39","#A2FF39","#A2FF39","#3338FF","#3338FF","#A2FF39","#A2FF39","#A2FF39","#A2FF39","#4C00FF","#4C00FF","#4C00FF","#4C00FF","#4C00FF","#4C00FF","#4C00FF","#4C00FF","#4C00FF","#4C00FF","#FFFF00","#FFFF00","#FFFF00","#FFFF00","#FFFF00","#FFFF00","#FFFF00","#FFFF00","#FFFF00","#FFFF00"],"weight":5,"opacity":0.5,"fill":true,"fillColor":["#2BFB6C","#2BFB6C","#2BFB6C","#2BFB6C","#2BFB6C","#2BFB6C","#2BFB6C","#2BFB6C","#3CECD0","#39BAFF","#3CECD0","#3CECD0","#3CECD0","#3CECD0","#39BAFF","#39BAFF","#3CECD0","#2863FF","#A2FF39","#A2FF39","#A2FF39","#A2FF39","#3338FF","#3338FF","#A2FF39","#A2FF39","#A2FF39","#A2FF39","#4C00FF","#4C00FF","#4C00FF","#4C00FF","#4C00FF","#4C00FF","#4C00FF","#4C00FF","#4C00FF","#4C00FF","#FFFF00","#FFFF00","#FFFF00","#FFFF00","#FFFF00","#FFFF00","#FFFF00","#FFFF00","#FFFF00","#FFFF00"],"fillOpacity":0.5},null,null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"setMaxBounds","args":[19.432241,-100,20,-98]}],"limits":{"lat":[-21.816105,20.869369],"lng":[-97.42486,80.4333]},"setView":[[20,-100],11,[]]},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level4">
<h4 id="extra-map-color-options-base-maps">Extra map color options (base maps)<a class="anchor" aria-label="anchor" href="#extra-map-color-options-base-maps"></a>
</h4>
<p><a href="https://rstudio.github.io/leaflet/basemaps.html" class="external-link uri">https://rstudio.github.io/leaflet/basemaps.html</a></p>
</div>
<div class="section level3">
<h3 id="mapping-a-tree-to-space">Mapping a tree to space<a class="anchor" aria-label="anchor" href="#mapping-a-tree-to-space"></a>
</h3>
<p>We will need one package we haven’t used yet, Liam Revell’s
Phytools.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"liamrevell/phytools"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Skipping install of 'phytools' from a github remote, the SHA1 (63c07a99) has not changed since last install.</span></span>
<span><span class="co">##   Use `force = TRUE` to force installation</span></span></code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/liamrevell/phytools" class="external-link">phytools</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: ape</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'ape'</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:dplyr':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     where</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: maps</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'maps'</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:purrr':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     map</span></span></code></pre>
<p>Plotting a phylogeny to a map is a fairly simple task, but has a lot
of data preparation work involved. The basic steps look like this:</p>
<ol style="list-style-type: decimal">
<li>Synchronize names between GBIF and OpenTree</li>
<li>Format GBIF data into a matrix</li>
<li>Add branch lengths to our tree</li>
<li>Plot</li>
</ol>
<p>You may have noticed that the GBIF package includes citation
information in the scientificName column. We will need to remove that.
To do this, let’s try the <code>strsplit</code> function. This function
splits a character string on a defined character and returns a vector of
the elements in that character string.</p>
<p>For example:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_string</span> <span class="op">=</span> <span class="st">"This is my string"</span></span>
<span><span class="va">split_up</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">my_string</span>, <span class="st">" "</span><span class="op">)</span></span>
<span><span class="va">split_up</span></span></code></pre></div>
<pre><code><span><span class="co">## [[1]]</span></span>
<span><span class="co">## [1] "This"   "is"     "my"     "string"</span></span></code></pre>
<p>Try indexing this object. What do you need to do to access data? Now,
with a partner, make this iterable across every row in the
<code>scientificName</code> column. Then, unite the split objects into
one new column called <code>genusSpecies</code>.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">split_names</span> <span class="op">&lt;-</span> <span class="va">no_na</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>genus <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_chr</a></span><span class="op">(</span><span class="va">scientificName</span>, <span class="kw">function</span><span class="op">(</span><span class="va">s</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">s</span>, <span class="st">" "</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>species <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_chr</a></span><span class="op">(</span><span class="va">scientificName</span>, <span class="kw">function</span><span class="op">(</span><span class="va">s</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">s</span>, <span class="st">" "</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unite.html" class="external-link">unite</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">genusSpecies</span>, <span class="va">genus</span>, <span class="va">species</span><span class="op">)</span></span></code></pre></div>
<p>If you look at the data, there are some obviously mistaken values in
there. For example, BOLD is not an ant species. Let’s drop that.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use ROTL to resolve names</span></span>
<span></span>
<span><span class="va">no_bold</span> <span class="op">&lt;-</span> <span class="va">split_names</span><span class="op">[</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"BOLD"</span>, <span class="va">split_names</span><span class="op">$</span><span class="va">genusSpecies</span>, invert <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> , <span class="op">]</span></span></code></pre></div>
<p>We also ended up with far more ant taxa than I thought. What a nice
problem to have! But let’s filter down to, say, five of them:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a_couple_ants</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Martialis_heureka"</span>, <span class="st">"Ectatomma_ruidum"</span>, <span class="st">"Ectatomma_tuberculatum"</span>, <span class="st">"Aneuretus_simoni"</span>, <span class="st">"Ectatomma_opaciventre"</span><span class="op">)</span></span>
<span><span class="va">subset_data</span> <span class="op">&lt;-</span> <span class="va">no_bold</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">genusSpecies</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">a_couple_ants</span><span class="op">)</span></span></code></pre></div>
<p>Now, let’s use ROTL to make sure we don’t have spelling errors.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reconciled_names</span> <span class="op">&lt;-</span> <span class="fu">rotl</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rotl/reference/tnrs_match_names.html" class="external-link">tnrs_match_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">subset_data</span><span class="op">$</span><span class="va">genusSpecies</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">good_names</span> <span class="op">&lt;-</span>  <span class="va">reconciled_names</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html" class="external-link">drop_na</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Now, we will query our tree from OpenTree.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu">rotl</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rotl/reference/tol_induced_subtree.html" class="external-link">tol_induced_subtree</a></span><span class="op">(</span><span class="va">good_names</span><span class="op">$</span><span class="va">ott_id</span>, label<span class="op">=</span><span class="st">"name"</span><span class="op">)</span></span></code></pre></div>
<pre><code>## 
Progress [----------------------------------] 0/14 (  0) ?s
Progress [================================] 14/14 (100)  0s
                                                            </code></pre>
<pre><code><span><span class="co">## Warning in collapse_singles(tr, show_progress): Dropping singleton nodes with</span></span>
<span><span class="co">## labels: mrcaott1682ott35311, mrcaott1682ott17752, mrcaott1682ott7438,</span></span>
<span><span class="co">## mrcaott1682ott34821, mrcaott34821ott950983, Aneuretinae, Aneuretus,</span></span>
<span><span class="co">## mrcaott4706ott5525, mrcaott5525ott48019, mrcaott48019ott688185, Ectatomminae,</span></span>
<span><span class="co">## mrcaott48019ott162057, Martialinae, Martialis</span></span></code></pre>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span></span></code></pre></div>
<p><img src="MappingAndTidyverse_files/figure-html/unnamed-chunk-25-1.png" width="700"></p>
<p>Now, we must combine our GBIF data and our taxon names into a matrix,
a two-dimensional data structure with fewer neat data parsing features
than a dataframe or tibble. These structures are often preferred when
speed is an issue. Matrices can only be one type, which means we must
add the row names after generating the object.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">only_lat_long</span> <span class="op">&lt;-</span> <span class="va">subset_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">decimalLatitude</span>, <span class="va">decimalLongitude</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">only_lat_long</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">subset_data</span><span class="op">$</span><span class="va">genusSpecies</span></span></code></pre></div>
<p>Lastly, let’s pick some colors for each species:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/" class="external-link">viridis</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: viridisLite</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'viridis'</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:maps':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     unemp</span></span></code></pre>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">color_selection</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span>n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/summary.phylo.html" class="external-link">Ntip</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="va">tree</span><span class="op">$</span><span class="va">tip.label</span><span class="op">)</span></span></code></pre></div>
<p>And the big reveal! Let’s overlay our OpenTree with our map:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obj</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/phytools/man/phylo.to.map.html" class="external-link">phylo.to.map</a></span><span class="op">(</span><span class="va">tree</span>,<span class="va">only_lat_long</span>, plot<span class="op">=</span><span class="cn">FALSE</span>, direction<span class="op">=</span><span class="st">"rightwards"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span></span></code></pre></div>
<p>Oh no! What has gone wrong?</p>
<p>This tree has several quirks. Have a look at the object and see if
you can spot them.</p>
<pre><code>
#Answer here

- No branch lengths
- Not fully bifurcating
</code></pre>
<p>First, let’s resolve the polytomy issue. We will do this using Ape’s
<code>multi2di</code> function, which arbitrarily resolves polytomies.
In real life, you would probably want to think about this a little
more.:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://ape-package.ird.fr/" class="external-link">ape</a></span><span class="op">)</span></span>
<span><span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/multi2di.html" class="external-link">multi2di</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span></span></code></pre></div>
<p>We’ll also need to add some branch lengths. In our case, we will draw
them from an exponential distribution. The exponential is often assumed
to be a reasonable approximation for banch lengths - you’ll hear more
about this if you take my systematics lab ;)</p>
<p>In our case, we will use <code>rexp</code> to make the draws, and we
will map them to a new attribute <code>edge.length</code> that is a
standard attribute of the tree object. In reality, you would likely not
want to do this for a publication quality analysis, and would want to
estimate branch lengths from data. But being able to rescale branch
lengths is a good skill for sensitivity and other similar analyses.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree</span><span class="op">$</span><span class="va">edge.length</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="va">tree</span><span class="op">$</span><span class="va">Nnode</span><span class="op">*</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">tree</span><span class="op">$</span><span class="va">edge.length</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.6844664 0.1997584 0.3924359 0.1509956 2.0682654 0.3108897</span></span></code></pre>
<p>Now let’s try that map again.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_object</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phytools/man/phylo.to.map.html" class="external-link">phylo.to.map</a></span><span class="op">(</span><span class="va">tree</span>, <span class="va">only_lat_long</span>, plot<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## objective: 6</span></span></code></pre>
<pre><code><span><span class="co">## objective: 2</span></span>
<span><span class="co">## objective: 2</span></span></code></pre>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_object</span></span></code></pre></div>
<pre><code><span><span class="co">## Object of class "phylo.to.map" containing:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## (1) A phylogenetic tree with 4 tips and 3 internal nodes.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## (2) A geographic map with range:</span></span>
<span><span class="co">##      -85.19N, 83.6N</span></span>
<span><span class="co">##      -180W, 180W.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## (3) A table containing 27 geographic coordinates (may include</span></span>
<span><span class="co">##     more than one set per species).</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## If optimized, tree nodes have been rotated to maximize alignment</span></span>
<span><span class="co">## with the map when the tree is plotted in a downwards direction.</span></span></code></pre>
<p>Finally, we will actually plot to space.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">plot_object</span>,direction<span class="op">=</span><span class="st">"rightwards"</span>,colors<span class="op">=</span><span class="va">color_selection</span>, cex.points<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, lwd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span>, ftype<span class="op">=</span><span class="st">"off"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## "phylo.to.map" direction is "downwards" but plot direction has been given as "rightwards".</span></span>
<span><span class="co">## Re-optimizing object....</span></span></code></pre>
<pre><code><span><span class="co">## objective: 4</span></span>
<span><span class="co">## objective: 4</span></span></code></pre>
<pre><code><span><span class="co">## objective: 2</span></span></code></pre>
<p><img src="MappingAndTidyverse_files/figure-html/unnamed-chunk-32-1.png" width="700"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by April Wright.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
